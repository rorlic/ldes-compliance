<?xml version="1.0" encoding="UTF-8"?>
<testcase id="BasicLdesTraversalTestCase" xmlns="http://www.gitb.com/tdl/v1/"
  xmlns:gitb="http://www.gitb.com/core/v1/">
  <metadata>
    <gitb:name>Basic LDES Traversal</gitb:name>
    <gitb:version>1.0</gitb:version>
    <gitb:description>Test case to verify a collection of LDES pages and the structure.</gitb:description>
  </metadata>
  <actors>
    <gitb:actor id="Client" />
    <gitb:actor id="Publisher" role="SUT" />
  </actors>
  <imports>
    <artifact from="TreeValidationSuite" type="binary" encoding="UTF-8" name="treeRootNodeTtl">resources/shapes/tree-root-node-shapes.ttl</artifact>
    <artifact from="TreeValidationSuite" type="binary" encoding="UTF-8" name="treeSubsequentTtl">resources/shapes/tree-subsequent-node-shapes.ttl</artifact>
    <artifact from="TreeValidationSuite" type="binary" encoding="UTF-8" name="treeStructureTtl">resources/shapes/tree-structure-shapes.ttl</artifact>
    <artifact type="binary" encoding="UTF-8" name="ldesRootNodeTtl">resources/shapes/ldes-root-node-shapes.ttl</artifact>
    <artifact type="binary" encoding="UTF-8" name="ldesSubsequentNodeTtl">resources/shapes/ldes-subsequent-node-shapes.ttl</artifact>
  </imports>
  <variables>
    <var name="url" type="string" />
    <var name="turtleContentType" type="string" />
    
    <var name="treeRootNodeShapes" type="map" />
    <var name="treeSubsequentShapes" type="map" />
    <var name="treeStructureShapes" type="map" />
    <var name="ldesRootNodeShapes" type="map" />
    <var name="ldesSubsequentShapes" type="map" />

    <var name="rootShapes" type="list[map]" />
    <var name="nodeShapes" type="list[map]" />
    <var name="treeShapes" type="list[map]" />
  </variables>
  <steps>
    <assign to="url" source="$Publisher{treeRootNodeUrl}"/>
    <assign to="turtleContentType">"text/turtle"</assign>
    
    <assign to="treeRootNodeShapes{content}">$treeRootNodeTtl</assign>
    <assign to="treeRootNodeShapes{contentType}">$turtleContentType</assign>
    <assign to="treeSubsequentShapes{content}">$treeSubsequentTtl</assign>
    <assign to="treeSubsequentShapes{contentType}">$turtleContentType</assign>
    <assign to="treeStructureShapes{content}">$treeStructureTtl</assign>
    <assign to="treeStructureShapes{contentType}">$turtleContentType</assign>
    
    <assign to="ldesRootNodeShapes{content}">$ldesRootNodeTtl</assign>
    <assign to="ldesRootNodeShapes{contentType}">$turtleContentType</assign>
    <assign to="ldesSubsequentShapes{content}">$ldesSubsequentNodeTtl</assign>
    <assign to="ldesSubsequentShapes{contentType}">$turtleContentType</assign>
    
    <assign to="rootShapes" append="true">$treeRootNodeShapes</assign>
    <assign to="rootShapes" append="true">$ldesRootNodeShapes</assign>
    <assign to="nodeShapes" append="true">$treeSubsequentShapes</assign>
    <assign to="nodeShapes" append="true">$ldesSubsequentShapes</assign>
    <assign to="treeShapes" append="true">$treeStructureShapes</assign>

    <call path="scriptlets/process-ldes-structure.xml">
      <input name="url">$url</input>
      <input name="rootShapes">$rootShapes</input>
      <input name="nodeShapes">$nodeShapes</input>
      <input name="treeShapes">$treeShapes</input>
      <input name="maxProcessedCount">$Publisher{treeMaxNodeCount}</input>
    </call>
  </steps>
  <output>
    <success>
      <default>"Basic LDES traversal test session completed successfully."</default>
    </success>
    <failure>
      <default>"The test session resulted in a failure. Please check the validation reports and apply required corrections."</default>
    </failure>
  </output>
</testcase>